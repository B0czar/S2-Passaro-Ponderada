<!-- Arquivo "index.html" -->

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
        <!-- Estamos carregando o Phaser diretamente de um CDN (Content Delivery Network). Isso significa que não precisamos baixar o arquivo manualmente e armazená-lo no projeto. O uso de um CDN melhora a velocidade de carregamento e pode reduzir o consumo de banda, pois o navegador pode reutilizar o arquivo se ele já foi carregado em outro site. E .min.js significa que o arquivo foi minificado, ou seja, seu tamanho foi reduzido para economizar espaço. -->

        <title>Pássaros enjaulado</title> 
        <!-- Título da página -->

        <link rel="icon" href="assets/web/favicon.svg" type="image/x-icon" />
        <!-- favicon da página -->

        <style>
            body {
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
                margin: 0;
            }
        </style>
    </head>
    <body>
        <script>
            var config = {
                type: Phaser.AUTO,
                width: window.innerWidth, //largura da janela
                height: window.innerHeight, //altura da janela

                scene: {
                    preload: preload,
                    create: create,
                    update: update,
                },
            };

            var game = new Phaser.Game(config);
            var passarinho; //variável da animação do pássaro

            function preload() {
                this.load.image("bg", "assets/bg/space.png"); //carrega a imagem de fundo

                this.load.spritesheet("bird", "assets/spriteSheets/bird.png", {
                    frameWidth: 75,
                    frameHeight: 75,
                }); //carrega o sprite do pássaro

                this.load.image("bar", "assets/bg/barsBg.png"); //carrega a "jaula"
            }

            function create() {
                this.bg = this.add
                    .tileSprite(
                        0,
                        0,
                        window.innerWidth,
                        window.innerHeight,
                        "bg"
                    )
                    .setOrigin(0, 0)
                    .setScale(1.2); //adiciona a imagem de fundo em tiles (prettier esta deixando desse jeito)

                this.bar = this.add
                    .tileSprite(
                        0,
                        0,
                        window.innerWidth,
                        window.innerHeight,
                        "bar"
                    )
                    .setOrigin(0, 0)
                    .setTileScale(0.3); //adiciona a imagem de fundo em tiles (prettier esta deixando desse jeito)

                passarinho = this.add
                    .sprite(window.innerWidth, window.innerHeight, "bird")
                    .setScale(1.3); //adiciona o sprite do pássaro (prettier esta deixando desse jeito)

                this.anims.create({
                    key: "fly",
                    frames: this.anims.generateFrameNumbers("bird", {
                        start: 0,
                        end: 7,
                    }), //(prettier esta deixando desse jeito)
                    frameRate: 10,
                    repeat: -1,
                });

                passarinho.anims.play("fly", true); //animação do pássaro
                window.addEventListener("resize", resizeGame); //adicionando listener para redimensionamento
            }

            function update() {
                const margin = 100;

                if (passarinho.x <= margin) {
                    passarinho.ida = true;
                    passarinho.flipX = false;
                }

                if (passarinho.x >= window.innerWidth - margin) {
                    passarinho.ida = false;
                    passarinho.flipX = true;
                }

                if (passarinho.ida) {
                    passarinho.x += 5;
                } else {
                    passarinho.x -= 5;
                }

                if (passarinho.y <= margin) {
                    passarinho.sobe = false;
                }

                if (passarinho.y >= window.innerHeight - margin) {
                    passarinho.sobe = true;
                }

                if (passarinho.sobe) {
                    passarinho.y -= 5;
                } else {
                    passarinho.y += 5;
                }
                //não sei se é a melhor lógica, mas funciona
            }

            function resizeGame() {
                game.scale.resize(window.innerWidth, window.innerHeight);
                game.scene.scenes[0].bg.setSize(
                    window.innerWidth,
                    window.innerHeight
                );
                passarinho.setPosition(
                    window.innerWidth / 2,
                    window.innerHeight / 2
                );
                //função para redimensionar o jogo (peguei inspiração da internet)
            }
        </script>
    </body>
</html>
